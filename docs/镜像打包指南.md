# socbak_allinone 功能说明

## 适配场景

- **芯片**：BM1684、BM1684X、BM1688、CV186AH
- **SDK 版本**：
  - 84&X 3.0.0 及之前版本（仅支持打包功能）
  - 84&X 3.0.0 之后版本（支持打包功能和打包做包功能）
  - 1688/186 V1.3 及之后版本（支持打包功能和打包做包功能）

## 环境需求

### 外置存储

- 存储分区格式建议使用 ext4，防止特殊分区限制导致做包失败。
- **只打包功能**：外置存储空间需为当前 eMMC 使用总量的 1.5 倍以上。
- **打包做包功能**：外置存储空间需为当前 eMMC 使用总量的 2.5 倍以上。

### 设备需求

- **只打包功能**：除打包设备外，还需一台 Ubuntu 18/20 的 X86 主机。
- **打包做包功能**：仅需一台打包做包的设备。

---

## 功能一：打包做包功能

本功能在 84&X 和 1688/186 平台的使用方式完全一致。

### 工具下载

```bash
pip3 install dfss --upgrade
python3 -m dfss --dflag=socbak
```

下载后会得到一个 `socbak.zip` 文件。

### 操作步骤

1. 将外置存储插入目标设备，并格式化为 EXT4 格式（假设为 `/dev/sda1`）。
2. 执行以下命令：

    ```bash
    sudo su
    cd /
    mkdir socrepack
    mount /dev/sda1 /socrepack
    chmod 777 /socrepack
    cd /socrepack
    ```

3. 将下载的 `socbak.zip` 传输到 `/socrepack` 目录下。
4. 执行如下命令进行打包：

    ```bash
    unzip socbak.zip
    cd socbak
    export SOC_BAK_ALL_IN_ONE=1
    bash socbak.sh
    ```

5. 等待一段时间，执行成功后会生成如下文件结构：

    ```bash
    root@sophon:/socrepack/socbak# tree -L 1
    .
    ├── binTools
    ├── output
    ├── script
    ├── socbak.sh
    ├── socbak_log.log
    └── socbak_md5.txt
    # 3 directories, 3 files
    ```

    - `socbak_log.log` 文件为执行信息记录
    - 刷机包位于 `output/sdcard/` 路径下